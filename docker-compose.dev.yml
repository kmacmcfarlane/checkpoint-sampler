services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./backend:/build
      - backend_data:/build/data
      - ./config.toml:/build/config.toml:ro
      - ${DATASET_ROOT:-./.dataset-placeholder}:/data/dataset:ro
      - backend_go_cache:/home/gouser/.cache/go-build
      - backend_go_mod_cache:/home/gouser/go/pkg/mod
    environment:
      - PORT=8080
      - CONFIG_PATH=/build/config.toml
      - GOPATH=/home/gouser/go
      - GOCACHE=/home/gouser/.cache/go-build
      - GOMODCACHE=/home/gouser/go/pkg/mod

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  frontend_node_modules:
  backend_go_cache:
  backend_go_mod_cache:
