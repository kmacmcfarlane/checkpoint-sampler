services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./backend:/build
      - backend_dev_data:/build/data
      - ./config.yaml:/build/config.yaml:ro
      - ${CHECKPOINT_DIR:-./.dataset-placeholder}:/data/checkpoints:ro
      - ${SAMPLE_DIR:-./.dataset-placeholder}:/data/samples:ro
      - backend_go_cache:/home/gouser/.cache/go-build
      - backend_go_mod_cache:/home/gouser/go/pkg/mod
    environment:
      - PORT=8080
      - CONFIG_PATH=/build/config.yaml
      - LOG_LEVEL=trace
      - GOPATH=/home/gouser/go
      - GOCACHE=/home/gouser/.cache/go-build
      - GOMODCACHE=/home/gouser/go/pkg/mod

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  frontend_node_modules:
  backend_dev_data:
  backend_go_cache:
  backend_go_mod_cache:
