services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./backend:/app/backend
      - backend_dev_data:/app/data
      - ./config.yaml:/app/config.yaml:ro
      - ./workflows:/app/workflows:ro
      - ${CHECKPOINT_DIR:-./.dataset-placeholder}:/data/checkpoints:ro
      - ${SAMPLE_DIR:-./.dataset-placeholder}:/data/samples:rw,bind
      - backend_go_cache:/home/gouser/.cache/go-build
      - backend_go_mod_cache:/home/gouser/go/pkg/mod
    environment:
      - PORT=8080
      - CONFIG_PATH=/app/config.yaml
      - LOG_LEVEL=trace
      - GOPATH=/home/gouser/go
      - GOCACHE=/home/gouser/.cache/go-build
      - GOMODCACHE=/home/gouser/go/pkg/mod

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  frontend_node_modules:
  backend_dev_data:
  backend_go_cache:
  backend_go_mod_cache:
